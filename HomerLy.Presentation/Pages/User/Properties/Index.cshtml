@page
@model HomerLy.Presentation.Pages.User.Properties.IndexModel
@{
    ViewData["Title"] = "Browse Properties";
    Layout = "~/Pages/Shared/_UserLayout.cshtml";
}

<div class="container-fluid animate-fade-in-up">
    <div class="d-flex justify-content-between align-items-center mb-4 mt-3">
        <div>
            <h2 class="h3 mb-1 fw-bold">Browse Properties</h2>
            <p class="text-muted mb-0">Find your next perfect home</p>
        </div>
        <a asp-page="/User/Dashboard" class="btn btn-outline-secondary rounded-pill btn-sm">
            <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>

    <!-- Search & Filter -->
    <div class="card glass-card mb-5 border-0">
        <div class="card-body p-4">
            <form method="get" class="row g-3">
                <div class="col-md-5">
                    <div class="form-floating">
                        <input type="text" class="form-control border-0 bg-light" id="search" placeholder="Search..."
                            name="search" value="@Model.SearchTerm">
                        <label for="search"><i class="bi bi-search me-2 text-muted"></i>Location, Property
                            Name...</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-floating">
                        <select class="form-select border-0 bg-light" id="priceRange" name="priceRange">
                            <option value="">Any Price</option>
                            <option value="0-5000000" selected="@(Model.PriceRange == "0-5000000")">Under 5M</option>
                            <option value="5000000-10000000" selected="@(Model.PriceRange == "5000000-10000000")">5M -
                                10M</option>
                            <option value="10000000+" selected="@(Model.PriceRange == "10000000+")">Above 10M</option>
                        </select>
                        <label for="priceRange">Price Range</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100 h-100 rounded-3 fw-bold shadow-sm">
                        Apply Filter
                    </button>
                </div>
                <div class="col-md-2">
                    <a asp-page="/User/Properties/Index"
                        class="btn btn-light w-100 h-100 rounded-3 border text-muted d-flex align-items-center justify-content-center">
                        Clear
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Properties Grid -->
    @if (Model.AvailableProperties != null && Model.AvailableProperties.Any())
    {
        <div class="row g-4 mb-5">
            @foreach (var property in Model.AvailableProperties)
            {
                <div class="col-xl-3 col-lg-4 col-md-6">
                    <div class="card property-card h-100 shadow-sm hover-lift">
                        <div class="img-wrapper bg-light position-relative">
                            @if (!string.IsNullOrEmpty(property.ImageUrl))
                            {
                                <img src="@property.ImageUrl" alt="@property.Title">
                            }
                            else
                            {
                                <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                                    <i class="bi bi-house-image fs-1 opacity-25"></i>
                                </div>
                            }

                            <!-- Badges -->
                            <div
                                class="position-absolute top-0 start-0 w-100 p-3 d-flex justify-content-between align-items-start">
                                <span class="badge bg-white text-dark shadow-sm rounded-pill px-3 py-2 fw-normal">
                                    <i class="bi bi-circle-fill text-success fs-xs me-1 small"></i> @property.Status
                                </span>

                                <form method="post" asp-page-handler="Favorite">
                                    <input type="hidden" name="propertyId" value="@property.Id" />
                                    <button type="submit"
                                        class="btn btn-light rounded-circle shadow-sm p-2 d-flex align-items-center justify-content-center"
                                        style="width: 35px; height: 35px;" title="Add to Favorites">
                                        <i class="bi bi-heart text-danger"></i>
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="card-body p-3">
                            <h5 class="card-title text-truncate fw-bold mb-1">@property.Title</h5>
                            <p class="card-text text-muted small mb-3 text-truncate">
                                <i class="bi bi-geo-alt me-1 text-primary"></i>@property.Address
                            </p>

                            <hr class="my-2 border-light">

                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <div>
                                    <h5 class="mb-0 text-primary fw-bold price tag">@property.MonthlyPrice.ToString("N0") ₫</h5>
                                    <small class="text-muted" style="font-size: 0.75rem;">/ month</small>
                                </div>
                                <div class="text-end">
                                    <span class="badge bg-light text-dark border">
                                        <i class="bi bi-arrows-fullscreen me-1"></i>@property.AreaSqm m²
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-white border-top-0 p-3 pt-0">
                            <a asp-page="/User/Properties/Details" asp-route-id="@property.Id"
                                class="btn btn-outline-primary w-100 rounded-pill btn-sm fw-bold">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Pagination -->
        @if (Model.TotalPages > 1)
        {
            <nav aria-label="Page navigation" class="mt-5 mb-5">
                <ul class="pagination justify-content-center pagination-lg">
                    <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link border-0 rounded-circle w-40px h-40px d-flex align-items-center justify-content-center shadow-sm mx-1"
                            asp-route-pageNumber="@(Model.CurrentPage - 1)" asp-route-search="@Model.SearchTerm"
                            asp-route-priceRange="@Model.PriceRange">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a class="page-link border-0 rounded-circle w-40px h-40px d-flex align-items-center justify-content-center shadow-sm mx-1"
                                asp-route-pageNumber="@i" asp-route-search="@Model.SearchTerm"
                                asp-route-priceRange="@Model.PriceRange">@i</a>
                        </li>
                    }
                    <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                        <a class="page-link border-0 rounded-circle w-40px h-40px d-flex align-items-center justify-content-center shadow-sm mx-1"
                            asp-route-pageNumber="@(Model.CurrentPage + 1)" asp-route-search="@Model.SearchTerm"
                            asp-route-priceRange="@Model.PriceRange">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        }
    }
    else
    {
        <div class="text-center py-5">
            <div class="mb-4">
                <div class="d-inline-block bg-secondary bg-opacity-10 p-5 rounded-circle text-secondary">
                    <i class="bi bi-search fs-1"></i>
                </div>
            </div>
            <h4 class="text-muted fw-bold">No properties found</h4>
            <p class="text-muted mb-4">We couldn't find any properties matching your criteria.</p>
            <a asp-page="/User/Properties/Index" class="btn btn-primary px-4 rounded-pill shadow-sm">Clear Filters</a>
        </div>
    }
</div>
